#!/bin/bash
set -e

# Загрузка переменных окружения из .env (если файл существует)
if [ -f .env ]; then
    echo "Загружаем переменные окружения из файла .env..."
    set -o allexport
    source .env
    set +o allexport
fi

# Остановка и удаление старых контейнеров (если они были запущены)
echo "Останавливаем предыдущие контейнеры (если есть)..."
docker compose down || echo "Контейнеры не запущены или уже остановлены"

# Сборка образа без использования кэша (чтобы пересобирать при каждом запуске)
echo "Собираем Docker-образ (без использования кэша)..."
docker compose build --no-cache

# Запуск контейнеров в фоновом режиме
echo "Запускаем контейнеры в фоне..."
docker compose up -d

echo "Скрипт выполнен успешно."
